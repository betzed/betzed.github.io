<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crash Verification</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="container">
    <h1 class="mt-4">Crash Verification</h1>

    <div class="mb-3">
        <label for="server-seed">Server seed</label>
        <input type="text" class="form-control" id="server" value="" onchange="update()" />
    </div>

    <div class="mb-3">
        <label for="client-seed">Client seed</label>
        <input type="text" class="form-control" id="client" value="" onchange="update()" />
    </div>

    <div class="mb-3">
        <label for="nonce">Nonce</label>
        <input type="text" class="form-control" id="nonce" value="" onchange="update()" />
    </div>

    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Nonce</th>
                    <th>Seed</th>
                    <th>Result</th>
                </tr>
            </thead>
            <tbody id="results">
            </tbody>
        </table>
    </div>

    <script src="./script.js"></script>
    <script>
        async function update() {
            let server = hexToUint8Array(
                document.getElementById('server').value.trim()
            );
            const client = document.getElementById('client').value.trim()

            let nonce = parseInt(document.getElementById('nonce').value);

            const results = document.getElementById('results');

            const E = 9007199254740991

            results.replaceChildren();

            for (let i = 0; i < 10; i++) {
                const seedNum = new SeedNum(server, client, nonce);

                const tr = document.createElement('tr')
                const tdNonce = document.createElement('td');
                tdNonce.textContent = nonce;

                const tdSeed = document.createElement('td');
                tdSeed.textContent = uint8ArrayToHex(server);

                const tdResult = document.createElement('td');

                const num = await seedNum.get4BytesNumber();
                const result = E / (Math.floor(num * E) + 1)

                const crashResult = Math.max(1, Math.min(1000000, Math.ceil(result * RTP * 100) / 100));
                tdResult.textContent = crashResult;

                tr.appendChild(tdNonce);
                tr.appendChild(tdSeed);
                tr.appendChild(tdResult);

                results.appendChild(tr);

                // update for next round
                nonce--;
                const buffer = await crypto.subtle.digest('SHA-256', server);
                server = new Uint8Array(buffer);
            }
        }

        (async () => {
            await update();
        })();

    </script>
</body>

</html>